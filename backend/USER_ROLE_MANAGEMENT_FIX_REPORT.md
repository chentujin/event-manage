# ç”¨æˆ·è§’è‰²ç®¡ç†åŠŸèƒ½ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°
ç”¨æˆ·åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢æ–°å»ºç”¨æˆ·æˆ–ç¼–è¾‘ç”¨æˆ·æ—¶ï¼Œè§’è‰²åˆ—è¡¨ä¸ºç©ºï¼Œæ— æ³•é€‰æ‹©è§’è‰²ã€‚

## é—®é¢˜åˆ†æ
é€šè¿‡ä»£ç å®¡æŸ¥å‘ç°ï¼Œé—®é¢˜å‡ºç°åœ¨å‰ç«¯APIè·¯å¾„é”™è¯¯ï¼š

### 1. å‰ç«¯APIè·¯å¾„é”™è¯¯
**é—®é¢˜ä»£ç **:
```javascript
// âŒ é”™è¯¯ï¼šä½¿ç”¨äº†é”™è¯¯çš„APIè·¯å¾„
const data = await request.get('/users/roles')
```

**é—®é¢˜åŸå› **:
åç«¯è§’è‰²æ¥å£çš„å®é™…è·¯å¾„æ˜¯`/roles`ï¼Œä¸æ˜¯`/users/roles`ã€‚

### 2. è§’è‰²æ•°æ®ç¼ºå¤±
**é—®é¢˜åˆ†æ**:
æ ¹æ®éœ€æ±‚æ–‡æ¡£ï¼Œç³»ç»Ÿéœ€è¦åŒ…å«ä»¥ä¸‹è§’è‰²ï¼š
- è¶…çº§ç®¡ç†å‘˜ (Admin)
- æ•…éšœç»ç† (Problem Manager)
- è´¨é‡ç®¡ç† (track-management)
- å·¥ç¨‹å¸ˆ (Engineer)
- åªè¯»ç”¨æˆ· (Viewer)
- æœåŠ¡å° (Service Desk)

ä½†å½“å‰ç³»ç»Ÿç¼ºå°‘`track-management`è§’è‰²ã€‚

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤å‰ç«¯APIè·¯å¾„
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ­£ç¡®çš„APIè·¯å¾„
const data = await request.get('/roles')
```

### 2. æ·»åŠ ç¼ºå¤±çš„è§’è‰²
æ ¹æ®éœ€æ±‚æ–‡æ¡£æ·»åŠ `track-management`è§’è‰²ï¼Œæ‹¥æœ‰é—®é¢˜ç®¡ç†ä¸å¤ç›˜ç®¡ç†æ‰€æœ‰æƒé™ã€‚

### 3. å®Œå–„è§’è‰²æƒé™è®¾è®¡
æŒ‰ç…§RBACæ¨¡å‹ï¼Œå®ç°åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚

## ä¿®å¤å†…å®¹

### å‰ç«¯ä¿®å¤
- **æ–‡ä»¶**: `frontend/src/views/Users.vue`
- **ä¿®å¤1**: å°†`/users/roles`æ”¹ä¸º`/roles`
- **ä¿®å¤2**: æ·»åŠ `track-management`è§’è‰²çš„ä¸­æ–‡æ˜ å°„
- **ä¿®å¤3**: æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜

### åç«¯ä¿®å¤
- **æ–‡ä»¶**: `backend/app/utils/init_data.py`
- **ä¿®å¤1**: æ·»åŠ `track-management`è§’è‰²å®šä¹‰
- **ä¿®å¤2**: ä¸º`track-management`è§’è‰²åˆ†é…ç›¸åº”æƒé™

## è§’è‰²æƒé™è®¾è®¡

### 1. è¶…çº§ç®¡ç†å‘˜ (Admin)
- **æƒé™**: æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œç®¡ç†ç³»ç»ŸåŸºç¡€è®¾ç½®
- **é€‚ç”¨åœºæ™¯**: ç³»ç»Ÿç®¡ç†å‘˜

### 2. æ•…éšœç»ç† (Problem Manager)
- **æƒé™**: æ•…éšœç›¸å…³æ‰€æœ‰æƒé™ï¼Œç‰¹åˆ«æ˜¯å®¡æ‰¹æƒé™
- **é€‚ç”¨åœºæ™¯**: æ•…éšœç®¡ç†è´Ÿè´£äºº

### 3. è´¨é‡ç®¡ç† (track-management)
- **æƒé™**: é—®é¢˜ç®¡ç†ä¸å¤ç›˜ç®¡ç†æ‰€æœ‰æƒé™
- **é€‚ç”¨åœºæ™¯**: è´¨é‡ç®¡ç†äººå‘˜

### 4. å·¥ç¨‹å¸ˆ (Engineer)
- **æƒé™**: åˆ›å»ºã€ç¼–è¾‘ã€è§£å†³äº‹ä»¶å’Œæ•…éšœï¼›æŸ¥çœ‹å‘Šè­¦åˆ—è¡¨
- **é€‚ç”¨åœºæ™¯**: æŠ€æœ¯å·¥ç¨‹å¸ˆ

### 5. åªè¯»ç”¨æˆ· (Viewer)
- **æƒé™**: åªèƒ½æŸ¥çœ‹äº‹ä»¶ç®¡ç†ã€æ•…éšœç®¡ç†æ•°æ®ï¼Œä¸èƒ½è¿›è¡Œä»»ä½•ä¿®æ”¹
- **é€‚ç”¨åœºæ™¯**: ä¸šåŠ¡äººå‘˜ã€è§‚å¯Ÿè€…

### 6. æœåŠ¡å° (Service Desk)
- **æƒé™**: ä¸“æ³¨äºäº‹ä»¶ç®¡ç†ã€å‘Šè­¦ç®¡ç†ä¸æ•…éšœç®¡ç†ï¼Œæƒé™ä»‹äºå·¥ç¨‹å¸ˆå’Œåªè¯»ç”¨æˆ·ä¹‹é—´
- **é€‚ç”¨åœºæ™¯**: æœåŠ¡å°äººå‘˜

## æƒé™åˆ†é…ç­–ç•¥

### 1. è§’è‰²ä¼˜å…ˆåˆ†é…
- ä¼˜å…ˆå°†è§’è‰²åˆ†é…ç»™**ç»„**ï¼Œå®ç°é«˜æ•ˆç®¡ç†
- ä¸ªäººç”¨æˆ·é€šè¿‡ç»„è·å¾—è§’è‰²æƒé™

### 2. æƒé™ç»§æ‰¿æœºåˆ¶
- ç”¨æˆ·ç›´æ¥åˆ†é…çš„è§’è‰²æƒé™
- é€šè¿‡ç»„è·å¾—çš„è§’è‰²æƒé™
- ä¸¤ç§æƒé™å–å¹¶é›†

### 3. æƒé™æ£€æŸ¥æµç¨‹
```python
def has_permission(self, permission_code):
    # ç›´æ¥åˆ†é…ç»™ç”¨æˆ·çš„æƒé™
    for role in self.roles:
        if role.has_permission(permission_code):
            return True
    
    # é€šè¿‡ç»„è·å¾—çš„æƒé™
    for group in self.groups:
        for role in group.roles:
            if role.has_permission(permission_code):
                return True
    
    return False
```

## éªŒè¯ç»“æœ

### åç«¯æ¥å£éªŒè¯ âœ…
**è§’è‰²æ¥å£**: `GET /api/v1/roles`
**è§’è‰²æ•°é‡**: 6ä¸ªï¼ˆåŒ…å«æ–°å¢çš„track-managementè§’è‰²ï¼‰
**è§’è‰²åˆ—è¡¨**:
- Admin: è¶…çº§ç®¡ç†å‘˜
- Problem Manager: æ•…éšœç»ç†
- track-management: è´¨é‡ç®¡ç†
- Engineer: å·¥ç¨‹å¸ˆ
- Service Desk: æœåŠ¡å°
- Viewer: åªè¯»ç”¨æˆ·

### å‰ç«¯åŠŸèƒ½éªŒè¯ âœ…
- **è§’è‰²åŠ è½½**: ä½¿ç”¨æ­£ç¡®çš„APIè·¯å¾„`/roles`
- **è§’è‰²æ˜¾ç¤º**: æ”¯æŒä¸­æ–‡è§’è‰²åç§°æ˜¾ç¤º
- **è§’è‰²é€‰æ‹©**: æ–°å»º/ç¼–è¾‘ç”¨æˆ·æ—¶å¯é€‰æ‹©è§’è‰²

## æŠ€æœ¯å®ç°

### 1. æ•°æ®æ¨¡å‹
```python
# ç”¨æˆ·-è§’è‰²å…³è”è¡¨
user_role = db.Table('user_role',
    db.Column('user_id', db.Integer, db.ForeignKey('users.id'), primary_key=True),
    db.Column('role_id', db.Integer, db.ForeignKey('roles.id'), primary_key=True)
)

# ç»„-è§’è‰²å…³è”è¡¨
group_role = db.Table('group_role',
    db.Column('group_id', db.Integer, db.ForeignKey('groups.id'), primary_key=True),
    db.Column('role_id', db.Integer, db.ForeignKey('roles.id'), primary_key=True)
)
```

### 2. æƒé™æ£€æŸ¥
```python
def has_permission(self, permission_code):
    """æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŒ‡å®šæƒé™"""
    # ç›´æ¥åˆ†é…ç»™ç”¨æˆ·çš„æƒé™
    for role in self.roles:
        if role.has_permission(permission_code):
            return True
    
    # é€šè¿‡ç»„è·å¾—çš„æƒé™
    for group in self.groups:
        for role in group.roles:
            if role.has_permission(permission_code):
                return True
    
    return False
```

## æ€»ç»“
ç”¨æˆ·è§’è‰²ç®¡ç†åŠŸèƒ½å·²æˆåŠŸä¿®å¤ï¼Œå®ç°äº†å®Œæ•´çš„RBACæƒé™æ§åˆ¶ç³»ç»Ÿï¼š

âœ… **APIè·¯å¾„ä¿®å¤** - å‰ç«¯ä½¿ç”¨æ­£ç¡®çš„è§’è‰²æ¥å£è·¯å¾„  
âœ… **è§’è‰²æ•°æ®å®Œå–„** - æ·»åŠ äº†ç¼ºå¤±çš„track-managementè§’è‰²  
âœ… **æƒé™è®¾è®¡ä¼˜åŒ–** - æŒ‰ç…§éœ€æ±‚æ–‡æ¡£å®ç°è§’è‰²æƒé™åˆ†é…  
âœ… **RBACæ¨¡å‹å®ç°** - æ”¯æŒç”¨æˆ·-è§’è‰²-æƒé™çš„å®Œæ•´æƒé™æ§åˆ¶  
âœ… **ä¸­æ–‡æ”¯æŒ** - è§’è‰²åç§°æ”¯æŒä¸­æ–‡æ˜¾ç¤º  

ç°åœ¨ç”¨æˆ·å¯ä»¥æ­£å¸¸é€‰æ‹©è§’è‰²ï¼Œç³»ç»Ÿå…·å¤‡å®Œæ•´çš„æƒé™æ§åˆ¶èƒ½åŠ›ï¼ğŸ‰

**å»ºè®®**: 
1. æµ‹è¯•å„ç§è§’è‰²çš„æƒé™æ§åˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œ
2. éªŒè¯ç»„æƒé™åˆ†é…åŠŸèƒ½
3. å®Œå–„æƒé™ç®¡ç†çš„ç”¨æˆ·ç•Œé¢
4. å»ºç«‹æƒé™å®¡è®¡æ—¥å¿—
